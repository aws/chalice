
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Upgrade Notes &#8212; AWS Chalice</title><link rel="stylesheet" href="_static/bootstrap-reboot.css" type="text/css" />
    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/default.css" />
    <link rel="stylesheet" href="_static/custom-tabs.css" type="text/css" />
    

    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script type="text/javascript">
        function _scroll(subjectId) {
            var subjectElement = $(subjectId);
            var actualSubjectHeight = subjectElement.height();
            var startingPosition = subjectElement[0].getBoundingClientRect().top;
            return function() {
                var availableHeight = $(window).height() - startingPosition;
                // Subtract the scroll position to account for sticky movement.
                availableHeight += Math.min($(window).scrollTop(), 40);
                var cappedHeight = Math.min(actualSubjectHeight, availableHeight);
                if (subjectElement.css("height") !== cappedHeight) {
                    subjectElement.css("height", cappedHeight);
                }
            };
        }

        // Scroll and resize the the columns when scrolled.
        $(function() {
            var rightScroll = _scroll("#right-column > .column-body");
            var scrollFn = function() {
                rightScroll.call(this, arguments);
            };
            scrollFn();
            $(window).scroll(scrollFn);
            $(window).resize(scrollFn);
        });

        // Scroll spy to change highlighted navigation element.
        $(function() {
            var section = document.querySelectorAll(".section");
            var sections = {};
            var i = 0;
            Array.prototype.forEach.call(section, function(e) {
                sections[e.id] = e.offsetTop;
            });
            var scrollSpy = function() {
                var scrollPosition = document.documentElement.scrollTop || document.body.scrollTop;
                for (i in sections) {
                    if (sections[i] <= scrollPosition) {
                        $('#right-column .current').removeClass('current');
                        $("#right-column a[href='#" + i + "']").addClass('current');
                    }
                }
            };
            $(window).scroll(scrollSpy);
            scrollSpy();
        });
    </script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-168492171-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-168492171-3');
    </script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Frequently Asked Questions" href="faq.html" />
    <link rel="prev" title="Todo Application" href="samples/todo-app/index.html" />
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="_static/fonts/open-sans/stylesheet.css" />
  
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


  </head><body>
    <header>
        <div class="header-flex width-wrapper">
            <div class="site-logo">
                <a href="index.html">
		  <span class="logo-icon"><img src="_static/img/chalice-logo-icon-small.png" /></span>
                </a>
            </div>

            <ul id="page-navigation">
                <li class="site-page first"><a href="quickstart.html">Quick Start</a></li>
                <li class="site-page"><a href="tutorials/index.html">Tutorials</a></li>
                <li class="site-page"><a href="samples/index.html">Samples</a></li>
                <li class="site-page"><a href="main.html">Documentation</a></li>
                <li class="site-page"><a href="https://github.com/aws/chalice">Code</a></li>
                <li class="site-search hidden-sm">
                    <form action="search.html" method="get">
                        <input type="hidden" name="check_keywords" value="yes" />
                        <input type="hidden" name="area" value="default" />
                        <input class="search-input" autocomplete="off" type="search" name="q" placeholder="Search" />
                    </form>
                </li>
            </ul>
        </div>
    </header>
    
        
        
        <section id="page-container">
            <div class="width-wrapper flex">
                <article id="document-body">
                    
                    
  <section id="upgrade-notes">
<h1>Upgrade Notes<a class="headerlink" href="#upgrade-notes" title="Permalink to this headline">¶</a></h1>
<p>This document provides additional documentation
on upgrading your version of chalice.  If you’re just
interested in the high level changes, see the
<a class="reference external" href="https://github.com/aws/chalice/blob/master/CHANGELOG.rst">CHANGELOG.rst</a>)
file.</p>
<section id="v1-2-0">
<span id="id1"></span><h2>1.2.0<a class="headerlink" href="#v1-2-0" title="Permalink to this headline">¶</a></h2>
<p>This release features a rewrite of the Chalice deployer
(<a class="reference external" href="https://github.com/aws/chalice/issues/604">#604</a>).
This is a backwards compatible change, and should not have any
noticeable changes with deployments with the exception of
fixing deployer bugs (e.g. <a class="reference external" href="https://github.com/aws/chalice/issues/604">https://github.com/aws/chalice/issues/604</a>).
This code path affects the <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">deploy</span></code>, <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">delete</span></code>, and
<code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">package</span></code> commands.</p>
<p>While this release is backwards compatible, you will notice several
changes when you upgrade to version 1.2.0.</p>
<p>The output of <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">deploy</span></code> has changed in order to give
more details about the resources it creates along with a more detailed
summary at the end:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ chalice deploy
Creating deployment package.
Creating IAM role: myapp-dev
Creating lambda function: myapp-dev-foo
Creating lambda function: myapp-dev
Creating Rest API
Resources deployed:
  - Lambda ARN: arn:aws:lambda:us-west-2:12345:function:myapp-dev-foo
  - Lambda ARN: arn:aws:lambda:us-west-2:12345:function:myapp-dev
  - Rest API URL: https://abcd.execute-api.us-west-2.amazonaws.com/api/
</pre></div>
</div>
<p>Also, the files used to store deployed values has changed.  These files are
used internally by the <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">deploy/delete</span></code> commands and you typically
do not interact with these files directly.  It’s mentioned here in case
you notice new files in your <code class="docutils literal notranslate"><span class="pre">.chalice</span></code> directory.  Note that these files
are <em>not</em> part of the public interface of Chalice and are documented here
for completeness and to help with debugging issues.</p>
<p>In versions &lt; 1.2.0, the value of deployed resources was stored in
<code class="docutils literal notranslate"><span class="pre">.chalice/deployed.json</span></code> and looked like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;dev&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;us-west-2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;api_handler_name&quot;</span><span class="p">:</span> <span class="s2">&quot;demoauth4-dev&quot;</span><span class="p">,</span>
    <span class="s2">&quot;api_handler_arn&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:lambda:us-west-2:123:function:myapp-dev&quot;</span><span class="p">,</span>
    <span class="s2">&quot;rest_api_id&quot;</span><span class="p">:</span> <span class="s2">&quot;abcd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lambda_functions&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;myapp-dev-foo&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;pure_lambda&quot;</span><span class="p">,</span>
        <span class="s2">&quot;arn&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:lambda:us-west-2:123:function:myapp-dev-foo&quot;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;chalice_version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.1.1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;api_gateway_stage&quot;</span><span class="p">:</span> <span class="s2">&quot;api&quot;</span><span class="p">,</span>
    <span class="s2">&quot;backend&quot;</span><span class="p">:</span> <span class="s2">&quot;api&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;prod&quot;</span><span class="p">:</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In version 1.2.0, the deployed resources are split into multiple files, one
file per chalice stage.  These files are in the
<code class="docutils literal notranslate"><span class="pre">.chalice/deployed/&lt;stage.json&gt;</span></code>, so if you had a dev and a prod chalice
stage you’d have <code class="docutils literal notranslate"><span class="pre">.chalice/deployed/dev.json</span></code> and
<code class="docutils literal notranslate"><span class="pre">.chalice/deployed/prod.json</span></code>.  The schema has also changed and looks
like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat .chalice/deployed/dev.json
{
  &quot;schema_version&quot;: &quot;2.0&quot;,
  &quot;resources&quot;: [
    {
      &quot;role_name&quot;: &quot;myapp-dev&quot;,
      &quot;role_arn&quot;: &quot;arn:aws:iam::123:role/myapp-dev&quot;,
      &quot;name&quot;: &quot;default-role&quot;,
      &quot;resource_type&quot;: &quot;iam_role&quot;
    },
    {
      &quot;lambda_arn&quot;: &quot;arn:aws:lambda:us-west-2:123:function:myapp-dev-foo&quot;,
      &quot;name&quot;: &quot;foo&quot;,
      &quot;resource_type&quot;: &quot;lambda_function&quot;
    },
    {
      &quot;lambda_arn&quot;: &quot;arn:aws:lambda:us-west-2:123:function:myapp-dev&quot;,
      &quot;name&quot;: &quot;api_handler&quot;,
      &quot;resource_type&quot;: &quot;lambda_function&quot;
    },
    {
      &quot;name&quot;: &quot;rest_api&quot;,
      &quot;rest_api_id&quot;: &quot;abcd&quot;,
      &quot;rest_api_url&quot;: &quot;https://abcd.execute-api.us-west-2.amazonaws.com/api&quot;,
      &quot;resource_type&quot;: &quot;rest_api&quot;
    }
  ],
  &quot;backend&quot;: &quot;api&quot;
}
</pre></div>
</div>
<p>When you run <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">deploy</span></code> for the first time after upgrading to version
1.2.0, chalice will automatically converted <code class="docutils literal notranslate"><span class="pre">.chalice/deployed.json</span></code> over to
the format as you deploy a given stage.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Once you upgrade to 1.2.0, chalice will only update the new
<code class="docutils literal notranslate"><span class="pre">.chalice/deployed/&lt;stage&gt;.json</span></code>.  This means you cannot downgrade
to earlier versions of chalice unless you manually update
<code class="docutils literal notranslate"><span class="pre">.chalice/deployed.json</span></code> as well.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">package</span></code> command has also been updated to use the
deployer.  This results in several changes compared to the previous
version:</p>
<ul class="simple">
<li><p>Pure lambdas are supported</p></li>
<li><p>Scheduled events are supported</p></li>
<li><p>Parity between the behavior of <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">deploy</span></code> and <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">package</span></code></p></li>
</ul>
<p>As part of this change, the CFN resource names have been updated
to use <code class="docutils literal notranslate"><span class="pre">CamelCase</span></code> names.  Previously, chalice converted your
python function names to CFN resource names by removing all
non alphanumeric characters and appending an md5 checksum,
e.g <code class="docutils literal notranslate"><span class="pre">my_function</span> <span class="pre">-&gt;</span> <span class="pre">myfunction3bfc</span></code>.  With this new packager
update, the resource name would be converted as
<code class="docutils literal notranslate"><span class="pre">my_function</span> <span class="pre">-&gt;</span> <span class="pre">MyFunction</span></code>.  Note, the <code class="docutils literal notranslate"><span class="pre">Outputs</span></code> section
renames unchanged in order to preserve backwards compatibility.
In order to fix parity issues with <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">deploy</span></code> and
<code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">package</span></code>, we now explicitly create an IAM role
resource as part of the default configuration.</p>
</section>
<section id="b2">
<span id="v1-0-0b2"></span><h2>1.0.0b2<a class="headerlink" href="#b2" title="Permalink to this headline">¶</a></h2>
<p>The url parameter names and the function argument names must match.
Previously, the routing code would use positional args <code class="docutils literal notranslate"><span class="pre">handler(*args)</span></code>
to invoke a view function.  In this version, kwargs are now used instead:
<code class="docutils literal notranslate"><span class="pre">handler(**view_args)</span></code>.  For example, this code will no longer work:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/</span><span class="si">{a}</span><span class="s1">/</span><span class="si">{b}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">myview</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{}</span>
</pre></div>
</div>
<p>The example above must be updated to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/</span><span class="si">{a}</span><span class="s1">/</span><span class="si">{b}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">myview</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{}</span>
</pre></div>
</div>
<p>Now that functions are invoked with kwargs, the order doesn’t matter.  You may
also write the above view function as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/</span><span class="si">{a}</span><span class="s1">/</span><span class="si">{b}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">myview</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{}</span>
</pre></div>
</div>
<p>This was done to have consistent behavior with other web frameworks such as
Flask.</p>
</section>
<section id="b1">
<span id="v1-0-0b1"></span><h2>1.0.0b1<a class="headerlink" href="#b1" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Chalice.define_authorizer</span></code> method has been removed.  This has been
deprecated since v0.8.1.  See <a class="reference internal" href="topics/authorizers.html"><span class="doc">Authorization</span></a> for updated
information on configuring authorizers in Chalice as well as the
original deprecation notice in the <a class="reference internal" href="#v0-8-1"><span class="std std-ref">0.8.1</span></a> upgrade notes.</p>
<p>The optional deprecated positional parameter in the <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">deploy</span></code> command
for specifying the API Gateway stage has been removed.  If you want to
specify the API Gateway stage, you can use the <code class="docutils literal notranslate"><span class="pre">--api-gateway-stage</span></code>
option in the <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">deploy</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Deprecated and removed in 1.0.0b1
$ chalice deploy prod

# Equivalent and updated way to specify an API Gateway stage:
$ chalice deploy --api-gateway-stage prod
</pre></div>
</div>
</section>
<section id="v0-9-0">
<span id="id2"></span><h2>0.9.0<a class="headerlink" href="#v0-9-0" title="Permalink to this headline">¶</a></h2>
<p>The 0.9.0 release changed the type of <code class="docutils literal notranslate"><span class="pre">app.current_request.raw_body</span></code> to
always be of type <code class="docutils literal notranslate"><span class="pre">bytes()</span></code>.  This only affects users that were using
python3.  Previously you would get a type <code class="docutils literal notranslate"><span class="pre">str()</span></code>, but with the introduction
of <a class="reference external" href="https://github.com/aws/chalice/issues/348">binary content type support</a>, the <code class="docutils literal notranslate"><span class="pre">raw_body</span></code> attribute
was made to consistently be of type <code class="docutils literal notranslate"><span class="pre">bytes()</span></code>.</p>
</section>
<section id="v0-8-1">
<span id="id3"></span><h2>0.8.1<a class="headerlink" href="#v0-8-1" title="Permalink to this headline">¶</a></h2>
<p>The 0.8.1 changed the preferred way of specifying authorizers for view
functions.  You now specify either an instance of
<code class="docutils literal notranslate"><span class="pre">chalice.CognitoUserPoolAuthorizer</span></code> or <code class="docutils literal notranslate"><span class="pre">chalice.CustomAuthorizer</span></code>
to an <code class="docutils literal notranslate"><span class="pre">&#64;app.route()</span></code> function using the <code class="docutils literal notranslate"><span class="pre">authorizer</span></code> argument.</p>
<p>Deprecated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/user-pools&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">],</span> <span class="n">authorizer_name</span><span class="o">=</span><span class="s1">&#39;MyPool&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">authenticated</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;secure&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

<span class="n">app</span><span class="o">.</span><span class="n">define_authorizer</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;MyPool&#39;</span><span class="p">,</span>
    <span class="n">header</span><span class="o">=</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span>
    <span class="n">auth_type</span><span class="o">=</span><span class="s1">&#39;cognito_user_pools&#39;</span><span class="p">,</span>
    <span class="n">provider_arns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;arn:aws:cognito:...:userpool/name&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Equivalent, and preferred way</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chalice</span> <span class="kn">import</span> <span class="n">CognitoUserPoolAuthorizer</span>

<span class="n">authorizer</span> <span class="o">=</span> <span class="n">CognitoUserPoolAuthorizer</span><span class="p">(</span>
    <span class="s1">&#39;MyPool&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span>
    <span class="n">provider_arns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;arn:aws:cognito:...:userpool/name&#39;</span><span class="p">])</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/user-pools&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">],</span> <span class="n">authorizer</span><span class="o">=</span><span class="n">authorizer</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">authenticated</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;secure&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">define_authorizer</span></code> is still available, but is now deprecated and will
be removed in future versions of chalice.  You can also use the new
<code class="docutils literal notranslate"><span class="pre">authorizer</span></code> argument to provider a <code class="docutils literal notranslate"><span class="pre">CustomAuthorizer</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chalice</span> <span class="kn">import</span> <span class="n">CustomAuthorizer</span>

<span class="n">authorizer</span> <span class="o">=</span> <span class="n">CustomAuthorizer</span><span class="p">(</span>
    <span class="s1">&#39;MyCustomAuth&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span>
    <span class="n">authorizer_uri</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;arn:aws:apigateway:region:lambda:path/2015-03-01&#39;</span>
                    <span class="s1">&#39;/functions/arn:aws:lambda:region:account-id:&#39;</span>
                    <span class="s1">&#39;function:FunctionName/invocations&#39;</span><span class="p">))</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/custom-auth&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">],</span> <span class="n">authorizer</span><span class="o">=</span><span class="n">authorizer</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">authenticated</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;secure&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="v0-7-0">
<span id="id4"></span><h2>0.7.0<a class="headerlink" href="#v0-7-0" title="Permalink to this headline">¶</a></h2>
<p>The 0.7.0 release adds several major features to chalice.  While the majority
of these features are introduced in a backwards compatible way, there are a few
backwards incompatible changes that were made in order to support these new
major features.</p>
<section id="separate-stages">
<h3>Separate Stages<a class="headerlink" href="#separate-stages" title="Permalink to this headline">¶</a></h3>
<p>Prior to this version, chalice had a notion of a “stage” that corresponded to
an API gateway stage.  You can create and deploy a new API gateway stage by
running <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">deploy</span> <span class="pre">&lt;stage-name&gt;</span></code>.  In 0.7.0, stage support was been
reworked such that a chalice stage is a completely separate set of AWS
resources.  This means that if you have two chalice stages, say <code class="docutils literal notranslate"><span class="pre">dev</span></code> and
<code class="docutils literal notranslate"><span class="pre">prod</span></code>, then you will have two separate sets of AWS resources, one set per
stage:</p>
<ul class="simple">
<li><p>Two API Gateway Rest APIs</p></li>
<li><p>Two separate Lambda functions</p></li>
<li><p>Two separate IAM roles</p></li>
</ul>
<p>The <a class="reference internal" href="topics/stages.html"><span class="doc">Chalice Stages</span></a> doc has more details on the new chalice stages
feature.  This section highlights the key differences between the old stage
behavior and the new chalice stage functionality in 0.7.0.  In order to ease
transition to this new model, the following changes were made:</p>
<ul class="simple">
<li><p>A new <code class="docutils literal notranslate"><span class="pre">--stage</span></code> argument was added to the <code class="docutils literal notranslate"><span class="pre">deploy</span></code>, <code class="docutils literal notranslate"><span class="pre">logs</span></code>, <code class="docutils literal notranslate"><span class="pre">url</span></code>,
<code class="docutils literal notranslate"><span class="pre">generate-sdk</span></code>, and <code class="docutils literal notranslate"><span class="pre">package</span></code> commands.  If this value is specified
and the stage does not exist, a new chalice stage with that name will
be created for you.</p></li>
<li><p>The existing form <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">deploy</span> <span class="pre">&lt;stage-name&gt;</span></code> has been deprecated.
The command will still work in version 0.7.0, but a deprecation warning
will be printed to stderr.</p></li>
<li><p>If you want the pre-existing behavior of creating a new API gateway stage
(while using the same Lambda function), you can use the
<code class="docutils literal notranslate"><span class="pre">--api-gateway-stage</span></code> argument.  This is the replacement for the
deprecated form <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">deploy</span> <span class="pre">&lt;stage-name&gt;</span></code>.</p></li>
<li><p>The default stage if no <code class="docutils literal notranslate"><span class="pre">--stage</span></code> option is provided is <code class="docutils literal notranslate"><span class="pre">dev</span></code>.  By
defaulting to a <code class="docutils literal notranslate"><span class="pre">dev</span></code> stage, the pre-existing behavior of not
specifying a stage name, e.g <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">deploy</span></code>, <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">url</span></code>, etc.
will still work exactly the same.</p></li>
<li><p>A new <code class="docutils literal notranslate"><span class="pre">stages</span></code> key is supported in the <code class="docutils literal notranslate"><span class="pre">.chalice/config.json</span></code>.  This
allows you to specify configuration specific to a chalice stage.
See the <a class="reference internal" href="topics/configfile.html"><span class="doc">Configuration File</span></a> doc for more information about stage
specific configuration.</p></li>
<li><p>Setting <code class="docutils literal notranslate"><span class="pre">autogen_policy</span></code> to false will result in chalice looking
for a IAM policy file named <code class="docutils literal notranslate"><span class="pre">.chalice/policy-&lt;stage-name&gt;.json</span></code>.
Previously it would look for a file named <code class="docutils literal notranslate"><span class="pre">.chalice/policy.json</span></code>.
You can also explicitly set this value to
In order to ease transition, chalice will check for a
<code class="docutils literal notranslate"><span class="pre">.chalice/policy.json</span></code> file when depoying to the <code class="docutils literal notranslate"><span class="pre">dev</span></code> stage.
Support for <code class="docutils literal notranslate"><span class="pre">.chalice/policy.json</span></code> will be removed in future
versions of chalice and users are encouraged to switch to the
stage specific <code class="docutils literal notranslate"><span class="pre">.chalice/policy-&lt;stage-name&gt;.json</span></code> files.</p></li>
</ul>
<p>See the <a class="reference internal" href="topics/stages.html"><span class="doc">Chalice Stages</span></a> doc for more details on the new chalice stages
feature.</p>
<p><strong>Note, the AWS resource names it creates now have the form
``&lt;app-name&gt;-&lt;stage-name&gt;``, e.g. ``myapp-dev``, ``myapp-prod``.</strong></p>
<p>We recommend using the new stage specific resource names.  However, If you
would like to use the existing resource names for a specific stage, you can
create a <code class="docutils literal notranslate"><span class="pre">.chalice/deployed.json</span></code> file that specifies the existing values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;dev&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;backend&quot;</span><span class="p">:</span> <span class="s2">&quot;api&quot;</span><span class="p">,</span>
    <span class="s2">&quot;api_handler_arn&quot;</span><span class="p">:</span> <span class="s2">&quot;lambda-function-arn&quot;</span><span class="p">,</span>
    <span class="s2">&quot;api_handler_name&quot;</span><span class="p">:</span> <span class="s2">&quot;lambda-function-name&quot;</span><span class="p">,</span>
    <span class="s2">&quot;rest_api_id&quot;</span><span class="p">:</span> <span class="s2">&quot;your-rest-api-id&quot;</span><span class="p">,</span>
    <span class="s2">&quot;api_gateway_stage&quot;</span><span class="p">:</span> <span class="s2">&quot;dev&quot;</span><span class="p">,</span>
    <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;your region (e.g us-west-2)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;chalice_version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.7.0&quot;</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This file is discussed in the next section.</p>
</section>
<section id="deployed-values">
<h3>Deployed Values<a class="headerlink" href="#deployed-values" title="Permalink to this headline">¶</a></h3>
<p>In version 0.7.0, the way deployed values are stored and retrieved
has changed.  In prior versions, only the <code class="docutils literal notranslate"><span class="pre">lambda_arn</span></code> was saved,
and its value was written to the <code class="docutils literal notranslate"><span class="pre">.chalice/config.json</span></code> file.
Any of other deployed values that were needed (for example the
API Gateway rest API id) was dynamically queried by assuming the
resource names matches the app name.  In this version of chalice,
a separate <code class="docutils literal notranslate"><span class="pre">.chalice/deployed.json</span></code> file is written on every
deployement which contains all the resources that have been created.
While this should be a transparent change, you may noticed
issues if you run commands such as <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">url</span></code> and <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">logs</span></code>
without first deploying.  To fix this issue, run <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">deploy</span></code>
and version 0.7.0 of chalice so a <code class="docutils literal notranslate"><span class="pre">.chalice/deployed.json</span></code> will
be created for you.</p>
</section>
<section id="authorizer-changes">
<h3>Authorizer Changes<a class="headerlink" href="#authorizer-changes" title="Permalink to this headline">¶</a></h3>
<p><strong>The ``authorizer_id`` and ``authorization_type`` args are
no longer supported in ``&#64;app.route(…)`` calls.</strong></p>
<p>They have been replaced with an <code class="docutils literal notranslate"><span class="pre">authorizer_name</span></code> parameter and an
<code class="docutils literal notranslate"><span class="pre">app.define_authorizer</span></code> method.</p>
<p>This version changed the internals of how an API gateway REST API is created.
Prior to 0.7.0, the AWS SDK for Python was used to make the appropriate service
API calls to API gateway include <code class="docutils literal notranslate"><span class="pre">create_rest_api</span></code> and <code class="docutils literal notranslate"><span class="pre">put_method</span> <span class="pre">/</span>
<span class="pre">put_method_response</span></code> for each route.  In version 0.7.0, this internal
mechanism was changed to instead generate a swagger document.  The rest api is
then created or updated by calling <code class="docutils literal notranslate"><span class="pre">import_rest_api</span></code> or <code class="docutils literal notranslate"><span class="pre">put_rest_api</span></code> and
providing the swagger document.  This simplifies the internals and also unifies
the code base for the newly added <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">package</span></code> command (which uses a
swagger document internally).  One consequence of this change is that the
entire REST API must be defined in the swagger document.  With the previous
<code class="docutils literal notranslate"><span class="pre">authorizer_id</span></code> parameter, you would create/deploy a rest api, create your
authorizer, and then provide that <code class="docutils literal notranslate"><span class="pre">authorizer_id</span></code> in your <code class="docutils literal notranslate"><span class="pre">&#64;app.route</span></code>
calls.  Now they must be defined all at once in the <code class="docutils literal notranslate"><span class="pre">app.py</span></code> file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">chalice</span><span class="o">.</span><span class="n">Chalice</span><span class="p">(</span><span class="n">app_name</span><span class="o">=</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/auth-required&#39;</span><span class="p">,</span> <span class="n">authorizer_name</span><span class="o">=</span><span class="s1">&#39;MyUserPool&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{}</span>

<span class="n">app</span><span class="o">.</span><span class="n">define_authorizer</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;MyUserPool&#39;</span><span class="p">,</span>
    <span class="n">header</span><span class="o">=</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span>
    <span class="n">auth_type</span><span class="o">=</span><span class="s1">&#39;cognito_user_pools&#39;</span><span class="p">,</span>
    <span class="n">provider_arns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;arn:aws:cognito:...:userpool/name&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="v0-6-0">
<span id="id5"></span><h2>0.6.0<a class="headerlink" href="#v0-6-0" title="Permalink to this headline">¶</a></h2>
<p>This version changed how the internals of how API gateway resources are created
by chalice.  The integration type changed from <code class="docutils literal notranslate"><span class="pre">AWS</span></code> to <code class="docutils literal notranslate"><span class="pre">AWS_PROXY</span></code>.  This
was to enable additional functionality, notable to allows users to provide
non-JSON HTTP responses and inject arbitrary headers to the HTTP responses.
While this change to the internals is primarily internal, there are several
user-visible changes.</p>
<ul>
<li><p>Uncaught exceptions with <code class="docutils literal notranslate"><span class="pre">app.debug</span> <span class="pre">=</span> <span class="pre">False</span></code> (the default value)
will result in a more generic <code class="docutils literal notranslate"><span class="pre">InternalServerError</span></code> error.  The
previous behavior was to return a <code class="docutils literal notranslate"><span class="pre">ChaliceViewError</span></code>.</p></li>
<li><p>When you enabled debug mode via <code class="docutils literal notranslate"><span class="pre">app.debug</span> <span class="pre">=</span> <span class="pre">True</span></code>, the HTTP
response will contain the python stack trace as the entire request
body.  This is to improve the readability of stack traces.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ http https://endpoint/dev/
HTTP/1.1 500 Internal Server Error
Content-Length: 358
Content-Type: text/plain

Traceback (most recent call last):
  File &quot;/var/task/chalice/app.py&quot;, line 286, in __call__
    response = view_function(*function_args)
  File &quot;/var/task/app.py&quot;, line 12, in index
    return a()
  File &quot;/var/task/app.py&quot;, line 16, in a
    return b()
  File &quot;/var/task/app.py&quot;, line 19, in b
    raise ValueError(&quot;Hello, error!&quot;)
ValueError: Hello, error!
</pre></div>
</div>
</li>
<li><p>Content type validation now has error responses that match the same error
response format used for other chalice built in responses.  Chalice was
previously relying on API gateway to perform the content type validation.
As a result of the <code class="docutils literal notranslate"><span class="pre">AWS_PROXY</span></code> work, this logic has moved into the chalice
handler and now has a consistent error response:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ http https://endpoint/dev/ &#39;Content-Type: text/plain&#39;
HTTP/1.1 415 Unsupported Media Type
Content-Type: application/json

{
    &quot;Code&quot;: &quot;UnsupportedMediaType&quot;,
    &quot;Message&quot;: &quot;Unsupported media type: text/plain&quot;
}
</pre></div>
</div>
</li>
<li><p>The keys in the <code class="docutils literal notranslate"><span class="pre">app.current_request.to_dict()</span></code> now match the casing used
by the <code class="docutils literal notranslate"><span class="pre">AWS_PPROXY</span></code> lambda integration, which are <code class="docutils literal notranslate"><span class="pre">lowerCamelCased</span></code>.
This method is primarily intended for introspection purposes.</p></li>
</ul>
</section>
</section>


                    
                    <section class="relations">
                        
                        <a href="samples/todo-app/index.html" title="previous chapter" class="previous-page clearfix hidden-xs">← Todo Application</a>
                        
                        <a href="faq.html" title="next chapter" class="next-page clearfix">Frequently Asked Questions →</a>
                    </section>
                    
                </article><aside id="right-column" class="side-column hidden-sm">
                    <div class="column-body">
                        <section class="sidebar">
                            
                            <section class="next-previous">
                                
                                <a href="samples/todo-app/index.html" title="previous chapter" class="previous-page clearfix hidden-xs">← Prev</a>
                                
                                <a href="faq.html" title="next chapter" class="next-page clearfix">Next →</a>
                            </section>
                            
                            <ul>
<li><a class="reference internal" href="#">Upgrade Notes</a><ul>
<li><a class="reference internal" href="#v1-2-0">1.2.0</a></li>
<li><a class="reference internal" href="#b2">1.0.0b2</a></li>
<li><a class="reference internal" href="#b1">1.0.0b1</a></li>
<li><a class="reference internal" href="#v0-9-0">0.9.0</a></li>
<li><a class="reference internal" href="#v0-8-1">0.8.1</a></li>
<li><a class="reference internal" href="#v0-7-0">0.7.0</a><ul>
<li><a class="reference internal" href="#separate-stages">Separate Stages</a></li>
<li><a class="reference internal" href="#deployed-values">Deployed Values</a></li>
<li><a class="reference internal" href="#authorizer-changes">Authorizer Changes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#v0-6-0">0.6.0</a></li>
</ul>
</li>
</ul>

                        </section>
                    </div>
                </aside></div>
        </section>
        
    
<footer id="footer">
    <div class="width-wrapper">
        <div class="copyright">
            <p>©2020, Amazon Web Services, Inc or its affiliates. All rights reserved.</p>
        </div>
    </div>
</footer>
  </body>
</html>