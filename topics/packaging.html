
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>App Packaging &#8212; AWS Chalice</title><link rel="stylesheet" href="../_static/bootstrap-reboot.css" type="text/css" />
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/default.css" />
    <link rel="stylesheet" href="../_static/custom-tabs.css" type="text/css" />
    

    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script type="text/javascript">
        function _scroll(subjectId) {
            var subjectElement = $(subjectId);
            var actualSubjectHeight = subjectElement.height();
            var startingPosition = subjectElement[0].getBoundingClientRect().top;
            return function() {
                var availableHeight = $(window).height() - startingPosition;
                // Subtract the scroll position to account for sticky movement.
                availableHeight += Math.min($(window).scrollTop(), 40);
                var cappedHeight = Math.min(actualSubjectHeight, availableHeight);
                if (subjectElement.css("height") !== cappedHeight) {
                    subjectElement.css("height", cappedHeight);
                }
            };
        }

        // Scroll and resize the the columns when scrolled.
        $(function() {
            var rightScroll = _scroll("#right-column > .column-body");
            var scrollFn = function() {
                rightScroll.call(this, arguments);
            };
            scrollFn();
            $(window).scroll(scrollFn);
            $(window).resize(scrollFn);
        });

        // Scroll spy to change highlighted navigation element.
        $(function() {
            var section = document.querySelectorAll(".section");
            var sections = {};
            var i = 0;
            Array.prototype.forEach.call(section, function(e) {
                sections[e.id] = e.offsetTop;
            });
            var scrollSpy = function() {
                var scrollPosition = document.documentElement.scrollTop || document.body.scrollTop;
                for (i in sections) {
                    if (sections[i] <= scrollPosition) {
                        $('#right-column .current').removeClass('current');
                        $("#right-column a[href='#" + i + "']").addClass('current');
                    }
                }
            };
            $(window).scroll(scrollSpy);
            scrollSpy();
        });
    </script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-168492171-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-168492171-3');
    </script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Python Version Support" href="pyversion.html" />
    <link rel="prev" title="Chalice Stages" href="stages.html" />
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


  </head><body>
    <header>
        <div class="header-flex width-wrapper">
            <div class="site-logo">
                <a href="../index.html">
		  <span class="logo-icon"><img src="../_static/img/chalice-logo-icon-small.png" /></span>
                </a>
            </div>

            <ul id="page-navigation">
                <li class="site-page first"><a href="../quickstart.html">Quick Start</a></li>
                <li class="site-page"><a href="../tutorials/index.html">Tutorials</a></li>
                <li class="site-page"><a href="../samples/index.html">Samples</a></li>
                <li class="site-page"><a href="../main.html">Documentation</a></li>
                <li class="site-page"><a href="https://github.com/aws/chalice">Code</a></li>
                <li class="site-search hidden-sm">
                    <form action="../search.html" method="get">
                        <input type="hidden" name="check_keywords" value="yes" />
                        <input type="hidden" name="area" value="default" />
                        <input class="search-input" autocomplete="off" type="search" name="q" placeholder="Search" />
                    </form>
                </li>
            </ul>
        </div>
    </header>
    
        
        
        <section id="page-container">
            <div class="width-wrapper flex">
                <article id="document-body">
                    
                    <ul class="rel-parents">
                    <li><a href="index.html" accesskey="U">Topics</a></li>
                    </ul>
                    
                    
  <section id="app-packaging">
<h1>App Packaging<a class="headerlink" href="#app-packaging" title="Permalink to this headline">¶</a></h1>
<p>In order to deploy your Chalice app, a zip file is created that
contains your application and all third party packages your application
requires.  This file is used by AWS Lambda and is referred
to as a deployment package.</p>
<p>Chalice will automatically create this deployment package for you, and offers
several features to make this easier to manage.  Chalice allows you to
clearly separate application specific modules and packages you are writing
from 3rd party package dependencies.</p>
<p>By default, Chalice will create a single zip file containing everything
necessary to deploy your application to Lambda.  Chalice also has
the ability to split your code into multiple files to leverage
<a class="reference external" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html">AWS Lambda layers</a>.
This is discussed in the <a class="reference internal" href="#package-3rd-party"><span class="std std-ref">3rd Party Packages</span></a> section below.</p>
<section id="app-directories">
<h2>App Directories<a class="headerlink" href="#app-directories" title="Permalink to this headline">¶</a></h2>
<p>You have two options to structure application specific code/config:</p>
<ul class="simple">
<li><p><strong>app.py</strong> - This file includes all your route information and is always
included in the deployment package.</p></li>
<li><p><strong>chalicelib/</strong> - This directory (if it exists) is included in the
deployment package.  This is where you can add config files and additional
application modules if you prefer not to have all your app code in the
<code class="docutils literal notranslate"><span class="pre">app.py</span></code> file.</p></li>
</ul>
<p>See <a class="reference internal" href="multifile.html"><span class="doc">Multifile Support</span></a> for more info on the <code class="docutils literal notranslate"><span class="pre">chalicelib/</span></code> directory.  Both the
<code class="docutils literal notranslate"><span class="pre">app.py</span></code> and the <code class="docutils literal notranslate"><span class="pre">chalicelib/</span></code> directory are intended for code that you
write yourself.</p>
</section>
<section id="rd-party-packages">
<span id="package-3rd-party"></span><h2>3rd Party Packages<a class="headerlink" href="#rd-party-packages" title="Permalink to this headline">¶</a></h2>
<p>When handling third party packages, you can have Chalice manage
these files as part of the deployment package of your Lambda function,
or as a separate Lambda layer that’s shared by all your Lambda functions.
See the <a class="reference internal" href="#package-examples"><span class="std std-ref">Examples</span></a> section for examples of how this works.</p>
<p>There are two options for handling python package dependencies:</p>
<ul class="simple">
<li><p><strong>requirements.txt</strong> - During the packaging process, Chalice will
install any packages it finds or can build compatible wheels for.
Specifically all pure python packages as well as all packages that upload
wheel files for the <code class="docutils literal notranslate"><span class="pre">manylinux1_x86_64</span></code> platform will be automatically
installable.</p></li>
<li><p><strong>vendor/</strong> - The <em>contents</em> of this directory are automatically added to
your deployment package and its location in your Lambda functions will
depend on whether you are using automatic Lambda Layers, described in the
<a class="reference internal" href="#package-auto-layers"><span class="std std-ref">Automatic Lambda Layers</span></a> section.</p></li>
</ul>
<p>Chalice will also check for an optional <code class="docutils literal notranslate"><span class="pre">vendor/</span></code> directory in the project
root directory.  The contents of this directory are automatically included in
the top level of the deployment package (see <a class="reference internal" href="#package-examples"><span class="std std-ref">Examples</span></a> for
specific examples).  The <code class="docutils literal notranslate"><span class="pre">vendor/</span></code> directory is helpful in these scenarios:</p>
<ul class="simple">
<li><p>You need to include custom packages or binary content that is not accessible
via <code class="docutils literal notranslate"><span class="pre">pip</span></code>.  These may be internal packages that aren’t public.</p></li>
<li><p>Wheel files are not available for a package you need from pip.</p></li>
<li><p>A package is installable with <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> but has optional c
extensions. Chalice can build the dependency without the c extensions, but
if you want better performance you can vendor a version that is compiled.</p></li>
</ul>
<p>As a general rule of thumb, code that you write goes in either <code class="docutils literal notranslate"><span class="pre">app.py</span></code> or
<code class="docutils literal notranslate"><span class="pre">chalicelib/</span></code>, and dependencies are either specified in <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>
or placed in the <code class="docutils literal notranslate"><span class="pre">vendor/</span></code> directory.</p>
<section id="automatic-lambda-layers">
<span id="package-auto-layers"></span><h3>Automatic Lambda Layers<a class="headerlink" href="#automatic-lambda-layers" title="Permalink to this headline">¶</a></h3>
<p>By default, Chalice will create a single zip file that contains all the
code needed to run your application.</p>
<p>You can set the <a class="reference internal" href="configfile.html#automatic-layer-option"><span class="std std-ref">automatic_layer</span></a> in your <code class="docutils literal notranslate"><span class="pre">.chalice/config.json</span></code>
file which will instruct Chalice to create your 3rd party packages as a
separate Lambda layer.</p>
<p>There are several benefits to this approach:</p>
<ul class="simple">
<li><p>The layer is created once and then shared across all Lambda functions in
your application.</p></li>
<li><p>When creating or updating a Lambda function, you send the entire contents
of the zip file that contains your app.  This is repeated for each Lambda
function.  As a result, there is unnecessary time and network bandwidth
used to send the same 3rd party dependencies for each Lambda function.
When using layers, Chalice will specify the layer ARN when creating or
updating your Lambda function, which cuts down on the time it takes
to package and deploy your application.</p></li>
<li><p>Saves storage space in Lambda.  There is a 75GB maximum size for all
your Lambda functions.  If you’re not using layers, each Lambda function
stores its own copies of your 3rd party dependencies.</p></li>
</ul>
<p>We recommend setting <code class="docutils literal notranslate"><span class="pre">&quot;automatic_layer&quot;:</span> <span class="pre">true</span></code> in your
<code class="docutils literal notranslate"><span class="pre">.chalice/config.json</span></code> due to these benefits.</p>
<p>Migrating to <code class="docutils literal notranslate"><span class="pre">&quot;automatic_layer&quot;:</span> <span class="pre">true</span></code> is mostly backwards compatible
with one notable exception: the location of the vendor files is different.</p>
<p>When not using automatic layers, any files placed in <code class="docutils literal notranslate"><span class="pre">vendor/</span></code> will be
available in your CWD of your application.  However, when using layers,
these files will be unzipped to <code class="docutils literal notranslate"><span class="pre">/opt/python/lib/pythonX.Y/site-packages</span></code>.
If you are using the <code class="docutils literal notranslate"><span class="pre">vendor/</span></code> directory to include custom built python
packages then this change is transparent as that directory is automatically
added to the python path.  However, if you are trying to read a file from
<code class="docutils literal notranslate"><span class="pre">vendor/</span></code> directly, then this will no longer work.  For example, if you
have:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── app.py
└── vendor
    └── myimage.png
</pre></div>
</div>
<p>And your <code class="docutils literal notranslate"><span class="pre">app.py</span></code> attempts to read this file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">lambda_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;myimage.png&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">do_something</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>This code will no longer work.  You have two options.  You can either place
static assets in <code class="docutils literal notranslate"><span class="pre">chalicelib/</span></code> or you’ll have to check both directories for
your file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;/opt/python/lib/python</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">/site-packages&#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">lambda_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">open_vendor_file</span><span class="p">(</span><span class="s1">&#39;myimage.png&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">do_something</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">open_vendor_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">directories</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/opt/python/lib/python</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">/site-packages&#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">dirname</span> <span class="ow">in</span> <span class="n">directories</span><span class="p">:</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">full_path</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="environment-variables">
<h2>Environment Variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h2>
<p>As part of the packaging and deployment process, Chalice will import your
<code class="docutils literal notranslate"><span class="pre">app.py</span></code> file.  This will result in any top level module code being
executed.  This can sometimes have undesireable behavior.
When running any Chalice CLI commands, a <code class="docutils literal notranslate"><span class="pre">AWS_CHALICE_CLI_MODE</span></code> environment
variable is set.  You can check if this env var is set in your <code class="docutils literal notranslate"><span class="pre">app.py</span></code>
if you have code that you don’t want to run whenever your app is packaged
and deployed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Chalice</span><span class="p">(</span><span class="n">app_name</span><span class="o">=</span><span class="s1">&#39;testimport&#39;</span><span class="p">)</span>

<span class="n">expensive_connection</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">if</span> <span class="s1">&#39;AWS_CHALICE_CLI_MODE&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="c1"># We&#39;re running in Lambda, we want to start up</span>
    <span class="c1"># our connection to our DB.</span>
    <span class="n">expensive_connection</span> <span class="o">=</span> <span class="n">ConnectToDB</span><span class="p">()</span>
</pre></div>
</div>
<p>Chalice will also set any environment variables specified in your global or
stage specific configuration whenever your app is packaged and deployed.
Per-Lambda function environment variables are not set when importing your app
(this would require importing your application for each Lambda function).  For
example, given the config below you would be able to access the <code class="docutils literal notranslate"><span class="pre">STAGE_VAR</span></code>
environment variable but not the <code class="docutils literal notranslate"><span class="pre">PER_FUNCTION</span></code> variable during the
building/packaging process when Chalice imports your application.  This
can be useful if you want to move configuration or resource names out of
your app.py file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;stages&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;dev&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;environment_variables&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;STAGE_VAR&quot;</span><span class="p">:</span> <span class="s2">&quot;stage-var&quot;</span>
      <span class="p">}</span>
      <span class="s2">&quot;api_gateway_stage&quot;</span><span class="p">:</span> <span class="s2">&quot;api&quot;</span><span class="p">,</span>
      <span class="s2">&quot;lambda_functions&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;environment_variables&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;PER_FUNCTION&quot;</span><span class="p">:</span> <span class="s2">&quot;per-function&quot;</span><span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
  <span class="s2">&quot;app_name&quot;</span><span class="p">:</span> <span class="s2">&quot;demo&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This only applies to the packaging stage.  When the <code class="docutils literal notranslate"><span class="pre">foo</span></code> function is invoked
on Lambda, the <code class="docutils literal notranslate"><span class="pre">PER_FUNCTION</span></code> environment variable will be set as expected.</p>
</section>
<section id="examples">
<span id="package-examples"></span><h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>Suppose I have the following app structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── app.py
├── chalicelib
│   ├── __init__.py
│   └── utils.py
├── requirements.txt
└── vendor
    ├── myimage.png
    └── internalpackage
        └── __init__.py
</pre></div>
</div>
<p>And the <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file had one requirement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat requirements.txt
sortedcontainers==1.5.4
</pre></div>
</div>
<p>With the default behavior of not using layers (<code class="docutils literal notranslate"><span class="pre">&quot;automatic_layer&quot;:</span> <span class="pre">false</span></code>),
the final deployment package directory structure would look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>deployment.zip
.
├── app.py
├── chalicelib
│   ├── __init__.py
│   └── utils.py
├── myimage.png
├── internalpackage
│   └── __init__.py
└── sortedcontainers
    └── __init__.py
</pre></div>
</div>
<p>This directory structure is then zipped up and sent to AWS Lambda during the
deployment process.  Suppose our application had two Lambda functions.
Each Lambda function has its own copy of the application deployment package,
as shown in the architecture diagram below.</p>
<a class="reference internal image-reference" href="../_images/no-auto-layer.png"><img alt="Default behavior with no layers." class="align-center" src="../_images/no-auto-layer.png" style="width: 50%;" /></a>
<p>If you are using <code class="docutils literal notranslate"><span class="pre">&quot;automatic_layer&quot;:</span> <span class="pre">true</span></code>, then two zip files will be
created. The deployment package used for the Lambda function will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>deployment.zip
.
├── app.py
└── chalicelib
    ├── __init__.py
    └── utils.py
</pre></div>
</div>
<p>And the zip file for the shared lambda layer will look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>layer-deployment.zip
.
└── python
    └── lib
        └── python3.7
            └── site-packages
                ├── myimage.png
                ├── internalpackage
                │   └── __init__.py
                └── sortedcontainers
                    └── __init__.py
</pre></div>
</div>
<p>Below is an updated diagram of the same Chalice application using automatic
layers.  Both functions now share the same Lambda layer that contains the third
party packages used by the application.</p>
<a class="reference internal image-reference" href="../_images/auto-layer.png"><img alt="Shared layer for 3rd party code." class="align-center" src="../_images/auto-layer.png" style="width: 80%;" /></a>
</section>
<section id="cryptography-example">
<h2>Cryptography Example<a class="headerlink" href="#cryptography-example" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since the original version of this example was written, cryptography has
released version 2.0 which does have manylinux1 wheels available. This
means if you want to use cryptography in a Chalice app all you need to
do is add <code class="docutils literal notranslate"><span class="pre">cryptography</span></code> or <code class="docutils literal notranslate"><span class="pre">cryptography&gt;=2.0</span></code> in your
requirements.txt file.</p>
<p>This example will use version 1.9 of Cryptography
because it is a good example of a library with C extensions and no wheel
files.</p>
</div>
<p>Below shows an example of how to use the
<a class="reference external" href="https://pypi.org/project/cryptography/1.9/">cryptography 1.9</a> package
in a Chalice app for the <code class="docutils literal notranslate"><span class="pre">python3.6</span></code> lambda environment.</p>
<p>Suppose you are on a Mac or Windows and want to deploy a Chalice app that
depends on the <code class="docutils literal notranslate"><span class="pre">cryptography==1.9</span></code> package. If you simply add it to your
<code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file and try to deploy it with <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">deploy</span></code> you will
get the following warning during deployment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat requirements.txt
cryptography==1.9
$ chalice deploy
Updating IAM policy.
Updating lambda function...
Creating deployment package.

Could not install dependencies:
cryptography==1.9
You will have to build these yourself and vendor them in
the chalice vendor folder.

Your deployment will continue but may not work correctly
if missing dependencies are not present. For more information:
http://aws.github.io/chalice/topics/packaging.html
</pre></div>
</div>
<p>This happened because the <code class="docutils literal notranslate"><span class="pre">cryptography</span></code> version 1.9 does not have wheel
files available on PyPi, and has C extensions. Since we are not on the same
platform as AWS Lambda, the compiled C extensions Chalice built were not
compatible. To get around this we are going to leverage the <code class="docutils literal notranslate"><span class="pre">vendor/</span></code>
directory, and build the <code class="docutils literal notranslate"><span class="pre">cryptography</span></code> package on a compatible linux system.</p>
<p>You can do this yourself by building <code class="docutils literal notranslate"><span class="pre">cryptography</span></code> on an Amazon Linux
instance running in EC2. All of the following commands were run inside a
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">3.6</span></code> virtual environment.</p>
<ul>
<li><p>Download the source first:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip download cryptography==1.9
</pre></div>
</div>
<p>This will download all the requirements into the current working directory.
The directory should have the following contents:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">asn1crypto-0.22.0-py2.py3-none-any.whl</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cffi-1.10.0-cp36-cp36m-manylinux1_x86_64.whl</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cryptography-1.9.tar.gz</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">idna-2.5-py2.py3-none-any.whl</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pycparser-2.17.tar.gz</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">six-1.10.0-py2.py3-none-any.whl</span></code></p></li>
</ul>
<p>This is a complete set of dependencies required for the cryptography package.
Most of these packages have wheels that were downloaded, which means they can
simply be put in the <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> and Chalice will take care of
downloading them. That leaves <code class="docutils literal notranslate"><span class="pre">cryptography</span></code> itself and <code class="docutils literal notranslate"><span class="pre">pycparser</span></code> as
the only two that did not have a wheel file available for download.</p>
</li>
<li><p>Next build the <code class="docutils literal notranslate"><span class="pre">cryptography</span></code> source package into a wheel file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip wheel cryptography-1.9.tar.gz
</pre></div>
</div>
<p>This will take a few seconds and build a wheel file for both <code class="docutils literal notranslate"><span class="pre">cryptography</span></code>
and <code class="docutils literal notranslate"><span class="pre">pycparser</span></code>. The directory should now have two additional wheel files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cryptography-1.9-cp36-cp36m-linux_x86_64.whl</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pycparser-2.17-py2.py3-none-any.whl</span></code></p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">cryptography</span></code> wheel file has been built with a compatible
architecture for Lambda (<code class="docutils literal notranslate"><span class="pre">linux_x86_64</span></code>) and the <code class="docutils literal notranslate"><span class="pre">pycparser</span></code> has been
built for <code class="docutils literal notranslate"><span class="pre">any</span></code> architecture which means it can also be automatically
packaged by Chalice if it is listed in the <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file.</p>
</li>
<li><p>Download the <code class="docutils literal notranslate"><span class="pre">cryptography</span></code> wheel file from the Amazon Linux instance and
unzip it into the <code class="docutils literal notranslate"><span class="pre">vendor/</span></code> directory in the root directory of your Chalice
app.</p>
<p>You should now have a project directory that looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tree
.
├── app.py
├── requirements.txt
└── vendor
    ├── cryptography
    │   ├── ... Lots of files
    │
    └── cryptography-1.9.dist-info
        ├── DESCRIPTION.rst
        ├── METADATA
        ├── RECORD
        ├── WHEEL
        ├── entry_points.txt
        ├── metadata.json
        └── top_level.txt
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file should look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat requirements.txt
cffi==1.10.0
six==1.10.0
asn1crypto==0.22.0
idna==2.5
pycparser==2.17
</pre></div>
</div>
<p>In your <code class="docutils literal notranslate"><span class="pre">app.py</span></code> file you can now import <code class="docutils literal notranslate"><span class="pre">cryptography</span></code>, and these
dependencies will all get included when the <code class="docutils literal notranslate"><span class="pre">chalice</span> <span class="pre">deploy</span></code> command is
run.</p>
</li>
</ul>
</section>
</section>


                    
                    <section class="relations">
                        
                        <a href="stages.html" title="previous chapter" class="previous-page clearfix hidden-xs">← Chalice Stages</a>
                        
                        <a href="pyversion.html" title="next chapter" class="next-page clearfix">Python Version Support →</a>
                    </section>
                    
                </article><aside id="right-column" class="side-column hidden-sm">
                    <div class="column-body">
                        <section class="sidebar">
                            
                            <section class="next-previous">
                                
                                <a href="stages.html" title="previous chapter" class="previous-page clearfix hidden-xs">← Prev</a>
                                
                                <a href="pyversion.html" title="next chapter" class="next-page clearfix">Next →</a>
                            </section>
                            
                            <ul>
<li><a class="reference internal" href="#">App Packaging</a><ul>
<li><a class="reference internal" href="#app-directories">App Directories</a></li>
<li><a class="reference internal" href="#rd-party-packages">3rd Party Packages</a><ul>
<li><a class="reference internal" href="#automatic-lambda-layers">Automatic Lambda Layers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#environment-variables">Environment Variables</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#cryptography-example">Cryptography Example</a></li>
</ul>
</li>
</ul>

                        </section>
                    </div>
                </aside></div>
        </section>
        
    
<footer id="footer">
    <div class="width-wrapper">
        <div class="copyright">
            <p>©2020, Amazon Web Services, Inc or its affiliates. All rights reserved.</p>
        </div>
    </div>
</footer>
  </body>
</html>