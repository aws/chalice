
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Blueprints &#8212; AWS Chalice</title><link rel="stylesheet" href="../_static/bootstrap-reboot.css" type="text/css" />
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/default.css" />
    <link rel="stylesheet" href="../_static/custom-tabs.css" type="text/css" />
    

    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script type="text/javascript">
        function _scroll(subjectId) {
            var subjectElement = $(subjectId);
            var actualSubjectHeight = subjectElement.height();
            var startingPosition = subjectElement[0].getBoundingClientRect().top;
            return function() {
                var availableHeight = $(window).height() - startingPosition;
                // Subtract the scroll position to account for sticky movement.
                availableHeight += Math.min($(window).scrollTop(), 40);
                var cappedHeight = Math.min(actualSubjectHeight, availableHeight);
                if (subjectElement.css("height") !== cappedHeight) {
                    subjectElement.css("height", cappedHeight);
                }
            };
        }

        // Scroll and resize the the columns when scrolled.
        $(function() {
            var rightScroll = _scroll("#right-column > .column-body");
            var scrollFn = function() {
                rightScroll.call(this, arguments);
            };
            scrollFn();
            $(window).scroll(scrollFn);
            $(window).resize(scrollFn);
        });

        // Scroll spy to change highlighted navigation element.
        $(function() {
            var section = document.querySelectorAll(".section");
            var sections = {};
            var i = 0;
            Array.prototype.forEach.call(section, function(e) {
                sections[e.id] = e.offsetTop;
            });
            var scrollSpy = function() {
                var scrollPosition = document.documentElement.scrollTop || document.body.scrollTop;
                for (i in sections) {
                    if (sections[i] <= scrollPosition) {
                        $('#right-column .current').removeClass('current');
                        $("#right-column a[href='#" + i + "']").addClass('current');
                    }
                }
            };
            $(window).scroll(scrollSpy);
            scrollSpy();
        });
    </script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-168492171-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-168492171-3');
    </script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Websockets" href="websockets.html" />
    <link rel="prev" title="Pure Lambda Functions" href="purelambda.html" />
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


  </head><body>
    <header>
        <div class="header-flex width-wrapper">
            <div class="site-logo">
                <a href="../index.html">
		  <span class="logo-icon"><img src="../_static/img/chalice-logo-icon-small.png" /></span>
                </a>
            </div>

            <ul id="page-navigation">
                <li class="site-page first"><a href="../quickstart.html">Quick Start</a></li>
                <li class="site-page"><a href="../tutorials/index.html">Tutorials</a></li>
                <li class="site-page"><a href="../samples/index.html">Samples</a></li>
                <li class="site-page"><a href="../main.html">Documentation</a></li>
                <li class="site-page"><a href="https://github.com/aws/chalice">Code</a></li>
                <li class="site-search hidden-sm">
                    <form action="../search.html" method="get">
                        <input type="hidden" name="check_keywords" value="yes" />
                        <input type="hidden" name="area" value="default" />
                        <input class="search-input" autocomplete="off" type="search" name="q" placeholder="Search" />
                    </form>
                </li>
            </ul>
        </div>
    </header>
    
        
        
        <section id="page-container">
            <div class="width-wrapper flex">
                <article id="document-body">
                    
                    <ul class="rel-parents">
                    <li><a href="index.html" accesskey="U">Topics</a></li>
                    </ul>
                    
                    
  <section id="blueprints">
<h1>Blueprints<a class="headerlink" href="#blueprints" title="Permalink to this headline">¶</a></h1>
<p>Chalice blueprints are used to organize your application into logical
components.  Using a blueprint, you define your resources and decorators in
modules outside of your <code class="docutils literal notranslate"><span class="pre">app.py</span></code>.  You then register a blueprint in your main
<code class="docutils literal notranslate"><span class="pre">app.py</span></code> file.  Blueprints support any decorator available on an application
object.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Chalice blueprints are conceptually similar to <a class="reference external" href="https://flask.palletsprojects.com/blueprints/">Blueprints</a> in Flask.  Flask
blueprints allow you to define a set of URL routes separately from the main
<code class="docutils literal notranslate"><span class="pre">Flask</span></code> object.  This concept is extended to all resources in Chalice.  A
Chalice blueprint can have Lambda functions, event handlers, built-in
authorizers, etc. in addition to a collection of routes.</p>
</div>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>In this example, we’ll create a blueprint with part of our routes defined in a
separate file.  First, let’s create an application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ chalice new-project blueprint-demo
$ cd blueprint-demo
$ mkdir chalicelib
$ touch chalicelib/__init__.py
$ touch chalicelib/blueprints.py
</pre></div>
</div>
<p>Next, we’ll open the <code class="docutils literal notranslate"><span class="pre">chalicelib/blueprints.py</span></code> file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chalice</span> <span class="kn">import</span> <span class="n">Blueprint</span>


<span class="n">extra_routes</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="nd">@extra_routes</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/foo&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">__name__</span></code> is used to denote the import path of the blueprint.  This name
must match the import name of the module so the function can be properly
imported when running in Lambda.  We’ll now import this module in our
<code class="docutils literal notranslate"><span class="pre">app.py</span></code> and register this blueprint.  We’ll also add a route in our
<code class="docutils literal notranslate"><span class="pre">app.py</span></code> directly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chalice</span> <span class="kn">import</span> <span class="n">Chalice</span>
<span class="kn">from</span> <span class="nn">chalicelib.blueprints</span> <span class="kn">import</span> <span class="n">extra_routes</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Chalice</span><span class="p">(</span><span class="n">app_name</span><span class="o">=</span><span class="s1">&#39;blueprint-demo&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">extra_routes</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;hello&#39;</span><span class="p">:</span> <span class="s1">&#39;world&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>At this point, we’ve defined two routes.  One route, <code class="docutils literal notranslate"><span class="pre">/</span></code>, is directly defined
in our <code class="docutils literal notranslate"><span class="pre">app.py</span></code> file.  The other route, <code class="docutils literal notranslate"><span class="pre">/foo</span></code> is defined in
<code class="docutils literal notranslate"><span class="pre">chalicelib/blueprints.py</span></code>.  It was added to our Chalice app when we
registered it via <code class="docutils literal notranslate"><span class="pre">app.register_blueprint(extra_routes)</span></code>.</p>
<p>We can deploy our application to verify this works as expected:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ chalice deploy
Creating deployment package.
Creating IAM role: blueprint-demo-dev
Creating lambda function: blueprint-demo-dev
Creating Rest API
Resources deployed:
  - Lambda ARN: arn:aws:lambda:us-west-2:1234:function:blueprint-demo-dev
  - Rest API URL: https://rest-api.execute-api.us-west-2.amazonaws.com/api/
</pre></div>
</div>
<p>We should now be able to request the <code class="docutils literal notranslate"><span class="pre">/</span></code> and <code class="docutils literal notranslate"><span class="pre">/foo</span></code> routes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ http https://rest-api.execute-api.us-west-2.amazonaws.com/api/
HTTP/1.1 200 OK
Connection: keep-alive
Content-Length: 17
Content-Type: application/json
Date: Sat, 22 Dec 2018 01:05:48 GMT
Via: 1.1 5ab5dc09da67e3ea794ec8a82992cc89.cloudfront.net (CloudFront)
X-Amz-Cf-Id: Cdsow9--fnTH5EdjkjWBMWINCCMD4nGmi4S_3iMYMK0rpc8Mpiymgw==
X-Amzn-Trace-Id: Root=1-5c1d8dec-f1ef3ee83c7c654ca7fb3a70;Sampled=0
X-Cache: Miss from cloudfront
x-amz-apigw-id: SSMc6H_yvHcFcEw=
x-amzn-RequestId: b7bd0c87-0585-11e9-90cf-59b71c1a1de1

{
    &quot;hello&quot;: &quot;world&quot;
}

$ http https://rest-api.execute-api.us-west-2.amazonaws.com/api/foo
HTTP/1.1 200 OK
Connection: keep-alive
Content-Length: 13
Content-Type: application/json
Date: Sat, 22 Dec 2018 01:05:51 GMT
Via: 1.1 95b0ac620fa3a80ee590ecf1cda1c698.cloudfront.net (CloudFront)
X-Amz-Cf-Id: HX4l1BNdWvYDRXan17PFZya1vaomoJel4rP7d8_stdw2qT50v7Iybg==
X-Amzn-Trace-Id: Root=1-5c1d8def-214e7f681ff82c00fd81f37a;Sampled=0
X-Cache: Miss from cloudfront
x-amz-apigw-id: SSMdXF40vHcF-mg=
x-amzn-RequestId: b96f77bf-0585-11e9-b229-01305cd40040

{
    &quot;foo&quot;: &quot;bar&quot;
}
</pre></div>
</div>
</section>
<section id="blueprint-registration">
<h2>Blueprint Registration<a class="headerlink" href="#blueprint-registration" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">app.register_blueprint</span></code> function accepts two optional arguments,
<code class="docutils literal notranslate"><span class="pre">name_prefix</span></code> and <code class="docutils literal notranslate"><span class="pre">url_prefix</span></code>.  This allows you to register the resources
in your blueprint at a certain url and name prefix.  If you specify
<code class="docutils literal notranslate"><span class="pre">url_prefix</span></code>, any routes defined in your blueprint will have the
<code class="docutils literal notranslate"><span class="pre">url_prefix</span></code> prepended to it.  If you specify the <code class="docutils literal notranslate"><span class="pre">name_prefix</span></code>, any Lambda
functions created will have the <code class="docutils literal notranslate"><span class="pre">name_prefix</span></code> prepended to the resource name.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">name_prefix</span></code> parameter does not apply to the Lambda function
associated with API Gateway, which is anything decorated with
<code class="docutils literal notranslate"><span class="pre">&#64;app.route()</span></code>.</p>
</div>
</section>
<section id="advanced-example">
<h2>Advanced Example<a class="headerlink" href="#advanced-example" title="Permalink to this headline">¶</a></h2>
<p>Let’s create a more advanced example.  If this application, let’s say we want
to organize our application into separate modules for our API and our event
sources.  We can create an app with these files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls -la chalicelib/
__init__.py
api.py
events.py
</pre></div>
</div>
<p>The contents of <code class="docutils literal notranslate"><span class="pre">api.py</span></code> are:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chalice</span> <span class="kn">import</span> <span class="n">Blueprint</span>


<span class="n">myapi</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="nd">@myapi</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;hello&#39;</span><span class="p">:</span> <span class="s1">&#39;world&#39;</span><span class="p">}</span>


<span class="nd">@myapi</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/foo&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>The contents of <code class="docutils literal notranslate"><span class="pre">events.py</span></code> are:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chalice</span> <span class="kn">import</span> <span class="n">Blueprint</span>


<span class="n">myevents</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="nd">@myevents</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span><span class="s1">&#39;rate(5 minutes)&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">cron</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="nd">@myevents</span><span class="o">.</span><span class="n">on_sns_message</span><span class="p">(</span><span class="s1">&#39;MyTopic&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">handle_sns_message</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>In our <code class="docutils literal notranslate"><span class="pre">app.py</span></code> we’ll register these blueprints:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chalice</span> <span class="kn">import</span> <span class="n">Chalice</span>
<span class="kn">from</span> <span class="nn">chalicelib.events</span> <span class="kn">import</span> <span class="n">myevents</span>
<span class="kn">from</span> <span class="nn">chalicelib.api</span> <span class="kn">import</span> <span class="n">myapi</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Chalice</span><span class="p">(</span><span class="n">app_name</span><span class="o">=</span><span class="s1">&#39;blueprint-demo&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">myevents</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">myapi</span><span class="p">)</span>
</pre></div>
</div>
<p>Now our <code class="docutils literal notranslate"><span class="pre">app.py</span></code> only registers the necessary blueprints, and all our
resources are defined in blueprints.</p>
</section>
</section>


                    
                    <section class="relations">
                        
                        <a href="purelambda.html" title="previous chapter" class="previous-page clearfix hidden-xs">← Pure Lambda Functions</a>
                        
                        <a href="websockets.html" title="next chapter" class="next-page clearfix">Websockets →</a>
                    </section>
                    
                </article><aside id="right-column" class="side-column hidden-sm">
                    <div class="column-body">
                        <section class="sidebar">
                            
                            <section class="next-previous">
                                
                                <a href="purelambda.html" title="previous chapter" class="previous-page clearfix hidden-xs">← Prev</a>
                                
                                <a href="websockets.html" title="next chapter" class="next-page clearfix">Next →</a>
                            </section>
                            
                            <ul>
<li><a class="reference internal" href="#">Blueprints</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
<li><a class="reference internal" href="#blueprint-registration">Blueprint Registration</a></li>
<li><a class="reference internal" href="#advanced-example">Advanced Example</a></li>
</ul>
</li>
</ul>

                        </section>
                    </div>
                </aside></div>
        </section>
        
    
<footer id="footer">
    <div class="width-wrapper">
        <div class="copyright">
            <p>©2020, Amazon Web Services, Inc or its affiliates. All rights reserved.</p>
        </div>
    </div>
</footer>
  </body>
</html>